<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='Reservation.css') }}">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">


</head>
<body>
<!-- partial:index.partial.html -->
<div class="app-container">
    
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="app-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="fill: white;width: 32px;height: 32px;margin-right: 10px;"><g><rect fill="none" height="24" width="24"></rect></g><g><g><path d="M16.39,9H7.61C7.18,9,6.8,9.28,6.66,9.68l-1.66,5v6.81C5,21.78,5.23,22,5.5,22h1C6.78,22,7,21.78,7,21.5V20h10v1.5 c0,0.28,0.22,0.5,0.5,0.5h1c0.28,0,0.5-0.22,0.5-0.5v-6.81l-1.66-5C17.2,9.28,16.82,9,16.39,9z M7.78,18 c-0.68,0-1.22-0.54-1.22-1.22s0.54-1.22,1.22-1.22S9,16.11,9,16.78S8.46,18,7.78,18z M16.22,18C15.55,18,15,17.46,15,16.78 s0.54-1.22,1.22-1.22s1.22,0.54,1.22,1.22S16.9,18,16.22,18z M6.29,14l1.33-4h8.78l1.33,4H6.29z"></path><path d="M10.83,3C10.41,1.83,9.3,1,8,1C6.34,1,5,2.34,5,4c0,1.65,1.34,3,3,3c1.3,0,2.41-0.84,2.83-2H16v2h2V5h1V3H10.83z M8,5 C7.45,5,7,4.55,7,4s0.45-1,1-1s1,0.45,1,1S8.55,5,8,5z"></path></g></g></svg>
        <span>Car Rental</span>
      </div>
    </div>
    <ul class="sidebar-list">
      <li class="sidebar-list-item">
        <a href="{{ url_for('views.managerHome') }}">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          <span>Home</span>
        </a>
      </li>
      <li class="sidebar-list-item">
        <a href="{{ url_for('views.clients') }}">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M16 9a4 4 0 1 1-8 0a4 4 0 0 1 8 0m-2 0a2 2 0 1 1-4 0a2 2 0 0 1 4 0"/><path d="M12 1C5.925 1 1 5.925 1 12s4.925 11 11 11s11-4.925 11-11S18.075 1 12 1M3 12c0 2.09.713 4.014 1.908 5.542A8.986 8.986 0 0 1 12.065 14a8.984 8.984 0 0 1 7.092 3.458A9 9 0 1 0 3 12m9 9a8.963 8.963 0 0 1-5.672-2.012A6.992 6.992 0 0 1 12.065 16a6.991 6.991 0 0 1 5.689 2.92A8.964 8.964 0 0 1 12 21"/></g></svg>
          <span>Clients</span>
        </a>
      </li>
      <li class="sidebar-list-item active">
        <a href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 2048 2048"><path fill="currentColor" d="M896 512v128H512V512zM512 896V768h384v128zm0 256v-128h256v128zM384 512v128H256V512zm0 256v128H256V768zm-128 384v-128h128v128zM128 128v1792h640v128H0V0h1115l549 549v219h-128V640h-512V128zm1024 91v293h293zm640 805h256v1024H896V1024h256V896h128v128h384V896h128zm128 896v-512h-896v512zm0-640v-128h-896v128z"/></svg>
          <span>Reservations</span>
        </a>
      </li>
      <li class="sidebar-list-item">
        <a href="{{ url_for('views.signin') }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="currentColor" d="M3 3h8V1H3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8v-2H3z"/><path fill="currentColor" d="M13 5v4H5v2h8v4l6-5z"/></svg>
            <span>Log out</span>
        </a>
      </li>
      <li class="sidebar-list-item">
      </li>
      <li class="sidebar-list-item">
      </li>
    </ul>
    <div class="account-info">
    </div>
  </div>
  <div class="app-content">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="app-content-actions">
      <input class="search-bar" placeholder="Search..." type="text">
      <div class="app-content-actions-wrapper">
        <div class="filter-button-wrapper">
          <div class="filter-menu">
          </div>
          <div class="app-content-header">
            <button class="mode-switch" title="Switch Theme">
              <svg class="moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="24" height="24" viewBox="0 0 24 24">
                <defs></defs>
                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="statics-center">
    <section class='statis text-center'>
        <div class="container-fluid">
          <div class="row">
            <!-- Statistics cards -->
            <div class="col-md-3">
              <div class="box bg-primary">
                  <i class="fa fa-calendar-check-o"></i>
                  <h3>{{ reservation_count }}</h3>
                  <p class="lead">Reservation{% if reservation_count != 1 %}s{% endif %}</p>
              </div>
            </div>
            <div class="col-md-3">
              <div class="box danger">
                <i class="fa fa-check-circle"></i>
                <h3>{{ confirmed_count }}</h3>
                <p class="lead">Confermed Reservation{% if confirmed_count != 1 %}s{% endif %}</p>
              </div>
            </div>
            <div class="col-md-3">
              <div class="box warning">
                <i class="fa fa-clock-o"></i>
                <h3>{{ pending_count }}</h3>
                <p class="lead">Pending Reservation{% if pending_count != 1 %}s{% endif %}</p>
              </div>
            </div>
      
          </div>
        </div>
      </section>
    </div>

    <div class="center-container">
    <div class="container">
        <div class="table-wrapper">
          <div class="table-title">
            <div class="row">
              <div class="col-sm-6">
                <h2>Manage <b>Reservation</b></h2>
              </div>
              <div class="col-sm-6">
                <a href="#addEmployeeModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>Add New Reservation</span></a>
                <!-- <a href="#deleteEmployeeModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a> -->
              </div>
            </div>
          </div>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>Car ID</th>
                <th>Client Name</th>
                <th>Email</th>
                <th>Duration</th>
                <th>Actions</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for reservation in reservations %}
                <tr>
                  <td>{{ reservation.carId }}</td>
                  <td>{{ reservation.clientName }}</td>
                  <td>{{ reservation.email }}</td>
                  <td>{{ reservation.duration }} days</td>
                  <td class="actions">
                    <a href="#editEmployeeModal" class="edit" data-carid="{{ reservation.carId }}" data-clientname="{{ reservation.clientName }}" data-email="{{ reservation.email }}" data-duration="{{ reservation.duration }}" data-id="{{ reservation._id }}" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i></a>
                    <a href="#deleteEmployeeModal" class="delete" data-id="{{ reservation._id }}" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i></a>
                    {% if reservation.status != "Confirmed" %}
                      <a href="#confirmEmployeeModal" class="confirm" data-id="{{ reservation._id }}" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Confirm">&#xE5CA;</i></a>
                    {% endif %}
                  </td>
                  <td>{{ reservation.status }}</td>
                </tr>
              {% endfor %}
            </tbody>
            

          </table>
        </div>
      </div>
      <!-- Add Modal HTML -->
      <div id="addEmployeeModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="addEmployeeForm" action="/add_reservation" method="POST">
                    <div class="modal-header">
                        <h4 class="modal-title">Add Reservation</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="carId">Car ID</label>
                            <input type="text" id="carId" name="carId" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="clientName">Client Name</label>
                            <input type="text" id="clientName" name="clientName" class="form-control" required>
                        </div>
                        <div class="form-group">
                          <label for="email">Email</label>
                          <input type="email" id="email" name="email" class="form-control" required>
                        </div>
                        <div class="form-group">
                          <label for="duration">Duration</label>
                          <input type="text" id="duration" name="duration" class="form-control" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <input type="submit" class="btn btn-success" value="Add">
                    </div>
                </form>
            </div>
        </div>
      </div>
      
      <!-- Edit Modal HTML -->
      <div id="editEmployeeModal" class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <form id="editEmployeeForm" action="/edit_reservation" method="POST">
              <div class="modal-header">
                  <h4 class="modal-title">Edit Reservation</h4>
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              </div>
              <div class="modal-body">
                  <div class="form-group">
                      <label for="carId">Car ID</label>
                      <input type="text" id="carId" name="carId" class="form-control" required>
                  </div>
                  <div class="form-group">
                      <label for="clientName">Client Name</label>
                      <input type="text" id="clientName" name="clientName" class="form-control" required>
                  </div>
                  <div class="form-group">
                      <label for="email">Email</label>
                      <input type="email" id="email" name="email" class="form-control" required>
                  </div>
                  <div class="form-group">
                    <label for="duration">Duration</label>
                    <input type="text" id="duration" name="duration" class="form-control" required>
                  </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                  <input type="submit" class="btn btn-success" value="Update">
              </div>
          </form>
          </div>
        </div>
      </div>
    </div>
        <!-- Delete Modal HTML -->
        <div id="deleteEmployeeModal" class="modal fade">
          <div class="modal-dialog">
            <div class="modal-content">
              <form method="post" action="/delete_reservation">
                <div class="modal-header">
                  <h4 class="modal-title">Delete Client</h4>
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                  <p>Are you sure you want to delete these Records?</p>
                  <p class="text-warning"><small>This action cannot be undone.</small></p>
                </div>
                <div class="modal-footer">
                  <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                  <input type="submit" class="btn btn-danger" value="Delete">
                </div>
              </form>
            </div>
          </div>
        </div>
    </div>
  </div>
</div>

<!-- Add Modal HTML for Confirmation -->
<div id="confirmEmployeeModal" class="modal fade">
  <div class="modal-dialog">
      <div class="modal-content">
          <form id="confirmEmployeeModalForm" action="/confirm_reservation" method="POST">
              <div class="modal-header">
                  <h4 class="modal-title">Confirm Reservation</h4>
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              </div>
              <div class="modal-body">
                  <p id="confirmationMessage">Are you sure you want to confirm this reservation?</p>
                  <!-- Hidden input field for reservation ID -->
                  <input type="hidden" id="reservationId" name="reservationId" value="">
              </div>
              <div class="modal-footer">
                  <!-- Button to close the modal -->
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary" id="confirmReservationButton">Confirm</button>
              </div>
          </form>
      </div>
  </div>
</div>



<!-- partial -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
      
  var modeSwitch = document.querySelector('.mode-switch');
  modeSwitch.addEventListener('click', function () {
    document.documentElement.classList.toggle('light');
    modeSwitch.classList.toggle('active');
  });
  
  
  $(document).ready(function(){
    // Activate tooltip
    $('[data-toggle="tooltip"]').tooltip();
    
    // Select/Deselect checkboxes
    var checkbox = $('table tbody input[type="checkbox"]');
    $("#selectAll").click(function(){
      if(this.checked){
        checkbox.each(function(){
          this.checked = true;                        
        });
      } else{
        checkbox.each(function(){
          this.checked = false;                        
        });
      } 
    });
    checkbox.click(function(){
      if(!this.checked){
        $("#selectAll").prop("checked", false);
      }
    });
  });

  const deleteBtns = Array.from(document.querySelectorAll(".actions .delete"))
  deleteBtns.forEach(el => {
    el.onclick = () => {
      const form = document.querySelector("#deleteEmployeeModal form")
      form.setAttribute('action', `/${el.dataset.id}/delete_reservation`)          
    }
  })
  
  const editBtns = Array.from(document.querySelectorAll(".actions .edit"))
  editBtns.forEach(el => {
    el.onclick = () => {
      const form = document.querySelector("#editEmployeeModal form")
      form.setAttribute('action', `/${el.dataset.id}/edit_reservation`)
      
      const carIdInput = form.querySelector("input[name='carId']")
      const clientNameInput = form.querySelector("input[name='clientName']")
      const emailInput = form.querySelector("input[name='email']")
      const durationInput = form.querySelector("input[name='duration']")

      carIdInput.value = el.dataset.carid
      clientNameInput.value = el.dataset.clientname
      emailInput.value = el.dataset.email
      durationInput.value = el.dataset.duration
    }
  })

  const confirmBtns = Array.from(document.querySelectorAll(".actions .confirm"))
  confirmBtns.forEach(el => {
    el.onclick = () => {
      const form = document.querySelector("#confirmEmployeeModal form")
      form.setAttribute('action', `/${el.dataset.id}/confirm_reservation`)
      
    }
  })

</script>
<script>
  // Close the alert message when the close button (X) is clicked
  document.querySelectorAll('.alert .close').forEach(function(button) {
    button.addEventListener('click', function() {
      this.parentElement.style.display = 'none'; // Hide the parent alert element
    });
  });
  </script>
</body>
</html>
